<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QNA Travel</title>
  <style>
    :root{
      --bg:#f7f7f7; --card:#fff; --text:#111; --muted:#666; --border:#ddd;
      --brand:#111; --brandText:#fff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:9;background:rgba(255,255,255,.92);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .topbar{max-width:980px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{font-weight:800;letter-spacing:.2px}
    nav{display:flex;gap:10px;flex-wrap:wrap}
    nav a{color:var(--text);text-decoration:none;font-size:14px;padding:6px 10px;border-radius:999px}
    nav a:hover{background:#f1f1f1}
    nav a.active{background:#111;color:#fff}
    .container{max-width:980px;margin:18px auto;padding:0 16px}
    .grid{display:grid;gap:12px}
    @media(min-width:860px){ .grid-2{grid-template-columns:1.2fr .8fr} }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
    .title{font-size:22px;font-weight:800;margin:0 0 8px}
    .muted{color:var(--muted);font-size:14px}
    .hr{height:1px;background:var(--border);margin:12px 0}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:8px;background:var(--brand);color:var(--brandText);border:none;border-radius:10px;padding:9px 12px;font-size:14px;cursor:pointer}
    .btn.secondary{background:#fff;color:#111;border:1px solid var(--border)}
    input{border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:14px;background:#fff;outline:none}
    input:focus{border-color:#aaa}
    .list{display:flex;flex-direction:column}
    .item{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;padding:10px 0;border-top:1px solid #eee}
    .item:first-child{border-top:none}
    .item h3{margin:0;font-size:16px}
    .item p{margin:4px 0 0;color:var(--muted);font-size:13px;line-height:1.4}
    .right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .star{cursor:pointer;user-select:none;font-size:20px;line-height:1}
    .star.on{color:#f5a623}
    .small{font-size:12px;color:var(--muted)}
    .footerNote{margin-top:10px;color:var(--muted);font-size:12px}

    .dayCard{border:1px solid var(--border);border-radius:14px;padding:14px;margin:12px 0;background:#fff}
    .dayHead{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:flex-end}
    .dayTitle{margin:0;font-size:16px;font-weight:800}
    .dayMeta{color:var(--muted);font-size:13px}
    .slot{display:grid;grid-template-columns:70px 1fr;gap:10px;padding:8px 0;border-top:1px solid #eee}
    .slot:first-of-type{border-top:none}

    .sectionTitle{font-weight:900;font-size:18px;margin:6px 0 10px}
    .subTitle{font-weight:800;font-size:16px;margin:0}
    .chipbar{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 10px;font-size:13px;cursor:pointer}
    .chip.active{border-color:#111;background:#111;color:#fff}

    /* Flight card */
    .flightCard{
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px 16px;
      display:flex;
      gap:14px;
      align-items:flex-start;
    }
    .flightIcon{
      width:40px;height:40px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      background:#111;color:#fff;font-size:20px;flex:0 0 auto;
    }
    .flightTitle{font-weight:900;margin:0 0 6px}
    .flightLine{margin:0;color:#222;font-size:14px;line-height:1.55}
    .flightLine span{color:var(--muted)}
  </style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">QNA & Peter âœˆï¸ ITALYğŸ•</div>
    <nav id="nav">
      <a href="#home" data-route="home">Home</a>
      <a href="#itinerary" data-route="itinerary">Itinerary</a>
      <a href="#explore" data-route="explore">Explore</a>
      <a href="#trips" data-route="trips">Trips</a>
    </nav>
  </div>
</header>

<div class="container" id="app"></div>

<script>
/** --------------------------
 * Utilities
 * -------------------------- */
const app = document.getElementById("app");

function groupBy(arr, keyFn){
  return arr.reduce((acc, x)=>{
    const k = keyFn(x);
    (acc[k] ||= []).push(x);
    return acc;
  }, {});
}

function labelType(t){
  const map = { spot:"æ™¯é»", food:"é¤å»³", cafe:"å’–å•¡", dessert:"ç”œé»" };
  return map[t] || t;
}

function typeEmoji(t){
  const map = { spot:"ğŸ“", food:"ğŸ½ï¸", cafe:"â˜•", dessert:"ğŸ°" };
  return map[t] || "â€¢";
}

/** --------------------------
 * Data
 * -------------------------- */
const trips = [
  { id:"italy-2026", name:"Italy Trip", city:"FlorenceğŸ‡  VeniceğŸ¾  RomeğŸ•", days:7, date:"4/4â€“4/12" }
];

const flightInfo = {
  outbound: { emoji:"ğŸ›«", text:"CI75 4/4 23:45 (TPE T1) â†’ 4/5 07:55 (FCO T3)" },
  inbound:  { emoji:"ğŸ›¬", text:"CI76 4/12 11:00 (FCO T3) â†’ 4/13 05:40 (TPE T1)" }
};

// åœ‹å®¶ â†’ åŸå¸‚ â†’ é¡å‹ï¼ˆspot / food / cafe / dessertï¼‰
const PLACE_DB = {
  Italy: {
    Rome: {
      spot: [
        { id:"it-rome-colosseum", name:"ç¾…é¦¬ç«¶æŠ€å ´ Colosseum", tags:["å¿…å»","å¤è¹Ÿ"] },
        { id:"it-rome-forum", name:"å¤ç¾…é¦¬å»£å ´ Roman Forum", tags:["å¤è¹Ÿ","æ­·å²"] },
        { id:"it-rome-pantheon", name:"è¬ç¥æ®¿ Pantheonï¼ˆå¤–è§€ï¼‰", tags:["å»ºç¯‰","å¸‚ä¸­å¿ƒ"] },
        { id:"it-rome-trevi", name:"ç‰¹é›·ç¶­å™´æ³‰ Trevi Fountain", tags:["å¿…å»","æ‹ç…§"] },
        { id:"it-rome-spanish", name:"è¥¿ç­ç‰™å°éš Spanish Steps", tags:["é€›è¡—","æ‹ç…§"] },
        { id:"it-rome-navona", name:"ç´æ²ƒç´å»£å ´ Piazza Navona", tags:["å»£å ´","æ•£æ­¥"] },
        { id:"it-rome-vatican", name:"æ¢µè’‚å²¡è–å½¼å¾—å»£å ´ St. Peterâ€™s Square", tags:["å®—æ•™","åœ°æ¨™"] },
      ],
      food: [
        { id:"it-rome-armando", name:"Armando al Pantheon", tags:["å‚³çµ±æ–™ç†","é«˜è©•åƒ¹"] },
        { id:"it-rome-daenzo", name:"Da Enzo al 29", tags:["åœ¨åœ°äººæ°£","æ’éšŠåº—"] },
        { id:"it-rome-roscioli", name:"Roscioli Salumeria con Cucina", tags:["ç¾©å¤§åˆ©éºµ","ç†Ÿé£Ÿ"] },
        { id:"it-rome-aimarmi", name:"Pizzeria Ai Marmi", tags:["æŠ«è–©","å¹³åƒ¹"] },
      ],
      cafe: [
        { id:"it-rome-greco", name:"Antico CaffÃ¨ Greco", tags:["ç™¾å¹´å’–å•¡","ç¶“å…¸"] },
        { id:"it-rome-tazza", name:"Tazza dâ€™Oro", tags:["ç²¾å“å’–å•¡","è¬ç¥æ®¿é™„è¿‘"] },
        { id:"it-rome-eustachio", name:"Santâ€™Eustachio Il CaffÃ¨", tags:["äººæ°£å’–å•¡"] },
      ],
      dessert: [
        { id:"it-rome-giolitti", name:"Giolitti Gelato", tags:["å†°æ·‡æ·‹","è€åº—"] },
        { id:"it-rome-teatro", name:"Gelateria del Teatro", tags:["å†°æ·‡æ·‹","é«˜è©•åƒ¹"] },
      ],
    },

    Florence: {
      spot: [
        { id:"it-flo-duomo", name:"è–æ¯ç™¾èŠ±å¤§æ•™å ‚ Florence Cathedral", tags:["å¿…å»","åœ°æ¨™"] },
        { id:"it-flo-duomo-square", name:"ä¸»æ•™åº§å ‚å»£å ´ Piazza del Duomo", tags:["å¸‚ä¸­å¿ƒ","æ•£æ­¥"] },
        { id:"it-flo-signoria", name:"é ˜ä¸»å»£å ´ Piazza della Signoria", tags:["é›•å¡‘","å»£å ´"] },
        { id:"it-flo-vecchio", name:"è€æ©‹ Ponte Vecchio", tags:["å¤œæ™¯","æ‹ç…§"] },
        { id:"it-flo-michelangelo", name:"ç±³é–‹æœ—åŸºç¾…å»£å ´ Piazzale Michelangelo", tags:["å¤•é™½","å±•æœ›å°"] },
        { id:"it-flo-mercato", name:"ä¸­å¤®å¸‚å ´ Mercato Centrale", tags:["ç¾é£Ÿ","å¸‚é›†"] },
      ],
      food: [
        { id:"it-flo-zaza", name:"Trattoria ZÃ  ZÃ ", tags:["æ‰˜æ–¯å¡å°¼æ–™ç†","äººæ°£"] },
        { id:"it-flo-bucamario", name:"Buca Mario", tags:["ä¸éª¨ç‰›æ’","è€åº—"] },
        { id:"it-flo-4leoni", name:"Trattoria 4 Leoni", tags:["æ¾éœ²ç¾©å¤§åˆ©éºµ"] },
        { id:"it-flo-santospirito", name:"Osteria Santo Spirito", tags:["åœ¨åœ°é¤é¤¨"] },
      ],
      cafe: [
        { id:"it-flo-gilli", name:"CaffÃ¨ Gilli", tags:["ç™¾å¹´å’–å•¡é¤¨"] },
        { id:"it-flo-ditta", name:"Ditta Artigianale", tags:["ç²¾å“å’–å•¡"] },
        { id:"it-flo-faro", name:"Faro â€“ CaffÃ¨ Specialty", tags:["æ‰‹æ²–å’–å•¡"] },
      ],
      dessert: [
        { id:"it-flo-carraia", name:"La Carraia Gelato", tags:["å†°æ·‡æ·‹","é«˜è©•åƒ¹"] },
        { id:"it-flo-percheno", name:"PerchÃ© No! Gelato", tags:["è€å­—è™Ÿ"] },
      ],
    },

    Venice: {
      spot: [
        { id:"it-ven-stmark", name:"è–é¦¬å¯å»£å ´ St Markâ€™s Square", tags:["å¿…å»","åœ°æ¨™"] },
        { id:"it-ven-basilica", name:"è–é¦¬å¯å¤§æ•™å ‚ St Markâ€™s Basilica", tags:["å®—æ•™","å¤–è§€"] },
        { id:"it-ven-doge", name:"ç¸½ç£å®® Dogeâ€™s Palace", tags:["æ­·å²","å¤–è§€"] },
        { id:"it-ven-rialto", name:"é‡Œäºæ‰˜æ©‹ Rialto Bridge", tags:["æ‹ç…§","é‹æ²³"] },
        { id:"it-ven-burano", name:"å¸ƒæ‹‰è«¾å½©è‰²å³¶ Burano", tags:["å½©è‰²å°å³¶","æ‹ç…§"] },
        { id:"it-ven-accademia", name:"å­¸é™¢æ©‹ Accademia Bridge", tags:["å¤•é™½","æ©‹"] },
      ],
      food: [
        { id:"it-ven-carampane", name:"Antiche Carampane", tags:["æµ·é®®","é«˜è©•åƒ¹"] },
        { id:"it-ven-daivo", name:"Da Ivo", tags:["å‚³çµ±æ–™ç†"] },
        { id:"it-ven-madonna", name:"Trattoria Alla Madonna", tags:["è€å­—è™Ÿ"] },
        { id:"it-ven-testiere", name:"Osteria alle Testiere", tags:["å°è€Œç²¾ç·»","éœ€è¨‚ä½"] },
      ],
      cafe: [
        { id:"it-ven-florian", name:"CaffÃ¨ Florian", tags:["ç™¾å¹´å’–å•¡é¤¨","è–é¦¬å¯å»£å ´"] },
        { id:"it-ven-cannaregio", name:"Torrefazione Cannaregio", tags:["åœ¨åœ°","å’–å•¡"] },
        { id:"it-ven-sullaluna", name:"Sullaluna", tags:["æ›¸åº—å’–å•¡"] },
      ],
      dessert: [
        { id:"it-ven-nico", name:"Gelateria Nico", tags:["å†°æ·‡æ·‹","æ²³å²¸"] },
        { id:"it-ven-natura", name:"Gelato di Natura", tags:["æ‰‹å·¥å†°æ·‡æ·‹"] },
      ],
    },
  },
};

function flattenPlaces(db){
  const out = [];
  for(const [country, cities] of Object.entries(db)){
    for(const [area, types] of Object.entries(cities)){
      for(const [type, items] of Object.entries(types)){
        for(const item of items){
          out.push({ ...item, country, area, type });
        }
      }
    }
  }
  return out;
}
const places = flattenPlaces(PLACE_DB);

const itinerary = [
  { day:1, date:"4/5", city:"Florence", move:"Rome â†’ Florence", items:[
    { period:"ä¸Šåˆ", zh:"ç¾…é¦¬æ­é«˜éµå‰å¾€ä½›ç¾…å€«æ–¯", en:"Train from Rome to Florence" },
    { period:"ä¸‹åˆ", zh:"ä½›ç¾…å€«æ–¯ä¸»æ•™åº§å ‚ï¼ˆå¤–è§€ï¼‰", en:"Florence Cathedral (Duomo, exterior)" },
    { period:"ä¸‹åˆ", zh:"ä¸»æ•™åº§å ‚å»£å ´", en:"Piazza del Duomo" },
    { period:"å‚æ™š", zh:"é ˜ä¸»å»£å ´", en:"Piazza della Signoria" },
    { period:"æ™šä¸Š", zh:"è€æ©‹å¤œæ™¯", en:"Ponte Vecchio" },
  ]},
  { day:2, date:"4/6", city:"Florence", items:[
    { period:"ä¸Šåˆ", zh:"Oltrarno å¥§çˆ¾ç‰¹æ‹‰è«¾ç”Ÿæ´»å€æ•£æ­¥", en:"Oltrarno district walk" },
    { period:"ä¸‹åˆ", zh:"æ³¢æ³¢é‡ŒèŠ±åœ’", en:"Boboli Gardens" },
    { period:"å‚æ™š", zh:"ç±³é–‹æœ—åŸºç¾…å»£å ´çœ‹å¤•é™½", en:"Piazzale Michelangelo viewpoint" },
  ]},
  { day:3, date:"4/7", city:"Venice", move:"Florence â†’ Venice", items:[
    { period:"ä¸Šåˆ", zh:"ä½›ç¾…å€«æ–¯æ­é«˜éµå‰å¾€å¨å°¼æ–¯", en:"Train from Florence to Venice" },
    { period:"ä¸‹åˆ", zh:"è–é¦¬å¯å»£å ´", en:"St Mark's Square" },
    { period:"å‚æ™š", zh:"è–é¦¬å¯å¤§æ•™å ‚ï¼ˆå¤–è§€ï¼‰", en:"St Mark's Basilica (exterior)" },
    { period:"æ™šä¸Š", zh:"ç¸½ç£å®®ï¼ˆå¤–è§€ï¼‰", en:"Doge's Palace (exterior)" },
  ]},
  { day:4, date:"4/8", city:"Venice", items:[
    { period:"ä¸Šåˆ", zh:"é‡Œäºæ‰˜æ©‹", en:"Rialto Bridge" },
    { period:"ä¸Šåˆ", zh:"é‡Œäºæ‰˜å¸‚å ´", en:"Rialto Market" },
    { period:"ä¸‹åˆ", zh:"å¸ƒæ‹‰è«¾å½©è‰²å³¶", en:"Burano Island" },
    { period:"å‚æ™š", zh:"å­¸é™¢æ©‹å¤•æ™¯", en:"Accademia Bridge" },
  ]},
  { day:5, date:"4/9", city:"Rome", move:"Venice â†’ Rome", items:[
    { period:"ä¸Šåˆ", zh:"å¨å°¼æ–¯æ­é«˜éµå›ç¾…é¦¬", en:"Train from Venice to Rome" },
    { period:"ä¸‹åˆ", zh:"æ¢µè’‚å²¡åŸåœ‹æ•£æ­¥", en:"Vatican City walk" },
    { period:"ä¸‹åˆ", zh:"è–å½¼å¾—å»£å ´", en:"St. Peterâ€™s Square" },
    { period:"å‚æ™š", zh:"è–å½¼å¾—å¤§æ•™å ‚ï¼ˆå¤–è§€ï¼‰", en:"St. Peterâ€™s Basilica (exterior)" },
    { period:"æ™šä¸Š", zh:"è–å¤©ä½¿å ¡ï¼ˆå¤–è§€æ•£æ­¥ï¼‰", en:"Castel Santâ€™Angelo (exterior)" },
  ]},
  { day:6, date:"4/10", city:"Rome", items:[
    { period:"ä¸Šåˆ", zh:"ç¾…é¦¬ç«¶æŠ€å ´", en:"Colosseum" },
    { period:"ä¸Šåˆ", zh:"å¤ç¾…é¦¬å»£å ´ï¼ˆå¤–åœæ•£æ­¥ï¼‰", en:"Roman Forum (outside area walk)" },
    { period:"ä¸­åˆ", zh:"çœŸç†ä¹‹å£æ‹ç…§", en:"Bocca della VeritÃ " },
    { period:"å‚æ™š", zh:"å¨å°¼æ–¯å»£å ´", en:"Piazza Venezia" },
  ]},
  { day:7, date:"4/11", city:"Rome", items:[
    { period:"ä¸Šåˆ", zh:"è¬ç¥æ®¿ï¼ˆå¤–è§€ï¼‰", en:"Pantheon (exterior)" },
    { period:"ä¸­åˆ", zh:"ç´æ²ƒç´å»£å ´", en:"Piazza Navona" },
    { period:"ä¸‹åˆ", zh:"ç‰¹é›·ç¶­å™´æ³‰", en:"Trevi Fountain" },
    { period:"å‚æ™š", zh:"è¥¿ç­ç‰™å°éš", en:"Spanish Steps" },
  ]},
];

/** --------------------------
 * Favorites
 * -------------------------- */
const FAV_KEY = "qna_travel_favs";
function getFavs(){ try { return new Set(JSON.parse(localStorage.getItem(FAV_KEY) || "[]")); } catch { return new Set(); } }
function saveFavs(set){ localStorage.setItem(FAV_KEY, JSON.stringify([...set])); }
let favs = getFavs();

function toggleFav(id){
  if(favs.has(id)) favs.delete(id); else favs.add(id);
  saveFavs(favs);
  render();
}

/** --------------------------
 * Router
 * -------------------------- */
function route(){ return (location.hash || "#home").replace("#",""); }
function setActive(r){
  document.querySelectorAll("#nav a").forEach(a=>{
    a.classList.toggle("active", a.dataset.route === r);
  });
}
window.addEventListener("hashchange", render);

/** --------------------------
 * Components
 * -------------------------- */
function renderFlightCard(){
  return `
    <div class="flightCard" style="margin-bottom:12px;">
      <div class="flightIcon">âœˆï¸</div>
      <div>
        <div class="flightTitle">èˆªç­è³‡è¨Š Flight Info</div>
        <p class="flightLine">${flightInfo.outbound.emoji} <strong>å»ç¨‹</strong>ï¼š${flightInfo.outbound.text}</p>
        <p class="flightLine">${flightInfo.inbound.emoji} <strong>å›ç¨‹</strong>ï¼š${flightInfo.inbound.text}</p>
        <p class="flightLine"><span>å°æé†’ï¼š</span>æ™‚é–“/èˆªå»ˆè‹¥æœ‰è®Šå‹•ï¼Œç›´æ¥æ”¹ flightInfo é€™å…©è¡Œå³å¯ã€‚</p>
      </div>
    </div>
  `;
}

/** --------------------------
 * Views
 * -------------------------- */
function renderHome(){
  const t = trips[0];
  app.innerHTML = `
    ${renderFlightCard()}

    <div class="grid grid-2">
      <div class="card">
        <div class="muted">Next Trip</div>
        <h1 class="title">${t.name}</h1>
        <div class="muted">${t.city} Â· ${t.days} days Â· ${t.date}</div>
        <div class="hr"></div>
        <div class="row">
          <button class="btn" onclick="location.hash='#itinerary'">ğŸ“… çœ‹è¡Œç¨‹ Itinerary</button>
          <button class="btn secondary" onclick="location.hash='#explore'">âœ¨ æ¢ç´¢æ¨è–¦ Explore</button>
        </div>
        <div class="footerNote">Tipï¼šæ”¶è— â­ æœƒå­˜åœ¨ä½ çš„ç€è¦½å™¨ï¼ˆlocalStorageï¼‰ã€‚</div>
      </div>

      <div class="card">
        <div class="muted">Quick Picks</div>
        <h2 class="title" style="font-size:18px;margin-top:6px;">æˆ‘çš„æ”¶è—</h2>
        <div class="list">${renderFavList()}</div>
      </div>
    </div>
  `;
}

function renderFavList(){
  const favArr = [...favs].map(id=>places.find(p=>p.id===id)).filter(Boolean);
  if(!favArr.length) return `<div class="muted">é‚„æ²’æœ‰æ”¶è—ï¼Œå» Explore é» â­ æ”¶è—å§ã€‚</div>`;
  return favArr.slice(0,8).map(p=>`
    <div class="item">
      <div>
        <h3>${typeEmoji(p.type)} ${p.name}</h3>
        <p>${p.country} Â· ${p.area} Â· ${labelType(p.type)} ${p.tags?.length? "Â· #"+p.tags.join(" #"):""}</p>
      </div>
      <div class="right">
        <span class="star on" onclick="toggleFav('${p.id}')" title="å–æ¶ˆæ”¶è—">â˜…</span>
      </div>
    </div>
  `).join("");
}

function renderTrips(){
  const t = trips[0];
  app.innerHTML = `
    ${renderFlightCard()}
    <div class="card">
      <h1 class="title">Trips</h1>
      <div class="list">
        <div class="item">
          <div>
            <h3>${t.name}</h3>
            <p>${t.city} Â· ${t.days} days Â· ${t.date}</p>
          </div>
          <div class="right">
            <button class="btn secondary" onclick="location.hash='#itinerary'">Open itinerary</button>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderItinerary(){
  const t = trips[0];
  app.innerHTML = `
    ${renderFlightCard()}

    <div class="card">
      <div class="muted">Itinerary</div>
      <h1 class="title">${t.name}</h1>
      <div class="muted">${t.city} Â· ${t.days} days Â· ${t.date}</div>

      <div class="hr"></div>

      ${itinerary.map(d=>`
        <div class="dayCard" id="day-${d.day}">
          <div class="dayHead">
            <div>
              <div class="dayTitle">Day ${d.day} (${d.date}) Â· ${d.city}</div>
              <div class="dayMeta">${d.move ? d.move : ""}</div>
            </div>
          </div>

          <div style="margin-top:8px;">
            ${d.items.map(i=>`
              <div class="slot">
                <div class="small">${i.period}</div>
                <div>${i.zh}ï½œ${i.en}</div>
              </div>
            `).join("")}
          </div>
        </div>
      `).join("")}

      <div class="footerNote">æƒ³æŠŠé¤å»³/å’–å•¡ã€Œæ’å…¥æ¯æ—¥è¡Œç¨‹ã€æˆ‘ä¹Ÿå¯ä»¥å¹«ä½ åšã€‚</div>
    </div>
  `;
}

function renderExplore(){
  const type = window.__type || "all";
  app.innerHTML = `
    ${renderFlightCard()}

    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:flex-end;">
        <div>
          <div class="muted">Explore</div>
          <h1 class="title">æ¨è–¦æ¸…å–®ï¼ˆä¾åœ‹å®¶/åŸå¸‚åˆ†å€ï¼‰</h1>
          <div class="muted">ğŸ“æ™¯é» ğŸ½ï¸é¤å»³ â˜•å’–å•¡ ğŸ°ç”œé»ï½œå¯æœå°‹ã€å¯æ”¶è— â­</div>
        </div>
        <div class="right">
          <input id="q" placeholder="æœå°‹ï¼šåç¨± / åœ‹å®¶ / åŸå¸‚ / æ¨™ç±¤..." />
        </div>
      </div>

      <div class="hr"></div>

      <div class="chipbar" id="chipbar">
        ${renderTypeChips(type)}
      </div>

      <div class="hr"></div>

      <div id="placeList"></div>
      <div class="footerNote">Tipï¼šé»å³å´ â­ æ”¶è—ï¼›å› Home æœƒçœ‹åˆ°æ”¶è—æ¸…å–®ã€‚</div>
    </div>
  `;

  document.getElementById("q").addEventListener("input", applyFilter);
  applyFilter();
}

function renderTypeChips(active){
  const chips = [
    {k:"all", t:"å…¨éƒ¨"},
    {k:"spot", t:"ğŸ“æ™¯é»"},
    {k:"food", t:"ğŸ½ï¸é¤å»³"},
    {k:"cafe", t:"â˜•å’–å•¡"},
    {k:"dessert", t:"ğŸ°ç”œé»"},
  ];
  return chips.map(c=>`
    <span class="chip ${active===c.k ? "active":""}" onclick="setType('${c.k}')">${c.t}</span>
  `).join("");
}

function setType(t){
  window.__type = t;
  document.getElementById("chipbar").innerHTML = renderTypeChips(t);
  applyFilter();
}

function applyFilter(){
  const q = (document.getElementById("q")?.value || "").toLowerCase().trim();
  const type = window.__type || "all";

  const filtered = places.filter(p=>{
    const okType = (type==="all") ? true : p.type === type;
    const hay = (p.name+" "+p.country+" "+p.area+" "+(p.tags||[]).join(" ")).toLowerCase();
    const okQ = q ? hay.includes(q) : true;
    return okType && okQ;
  });

  const list = document.getElementById("placeList");
  if(!filtered.length){
    list.innerHTML = `<div class="muted">æ²’æœ‰ç¬¦åˆçš„çµæœï¼Œæ›å€‹é—œéµå­—æˆ–é¡å‹è©¦è©¦ã€‚</div>`;
    return;
  }

  const byCountry = groupBy(filtered, p=>p.country || "Other");
  const countries = Object.keys(byCountry).sort();

  list.innerHTML = countries.map(country=>{
    const itemsCountry = byCountry[country];
    const byArea = groupBy(itemsCountry, p=>p.area || "Other");
    const areas = Object.keys(byArea).sort();

    return `
      <div style="margin:8px 0 22px;">
        <div class="sectionTitle">${country === "Italy" ? "ğŸ‡®ğŸ‡¹" : "ğŸŒ"} ${country}</div>

        ${areas.map(area=>{
          const itemsArea = byArea[area];

          return `
            <div class="card" style="margin:10px 0;">
              <div class="row" style="justify-content:space-between;">
                <div class="subTitle">${area}</div>
                <div class="muted">${itemsArea.length} items</div>
              </div>

              <div class="hr"></div>

              <div class="list">
                ${itemsArea.map(p=>`
                  <div class="item">
                    <div>
                      <h3>${typeEmoji(p.type)} ${p.name}</h3>
                      <p>${labelType(p.type)}${p.tags?.length ? ` Â· #${p.tags.join(" #")}` : ""}</p>
                    </div>
                    <div class="right">
                      <span class="star ${favs.has(p.id) ? "on":""}"
                        onclick="toggleFav('${p.id}')"
                        title="${favs.has(p.id) ? "å–æ¶ˆæ”¶è—" : "åŠ å…¥æ”¶è—"}">${favs.has(p.id) ? "â˜…" : "â˜†"}</span>
                    </div>
                  </div>
                `).join("")}
              </div>
            </div>
          `;
        }).join("")}
      </div>
    `;
  }).join("");
}

/** --------------------------
 * Main render
 * -------------------------- */
function route(){
  const r = (location.hash || "").replace("#","");
  return r || "home"; // âœ… æ²’æœ‰ hash ä¹Ÿç›´æ¥å› home
}

function render(){
  const r = route();
  setActive(r);

  if(r === "home") return renderHome();
  if(r === "itinerary") return renderItinerary();
  if(r === "explore") return renderExplore();
  if(r === "trips") return renderTrips();

  // âœ… é‡åˆ°æœªçŸ¥ hashï¼šç›´æ¥æ¸²æŸ“ homeï¼Œä¸è¦åªæ”¹ hash è®“ç•«é¢ç©ºç™½
  location.hash = "#home";
  return renderHome();
}

window.addEventListener("hashchange", render);
window.addEventListener("DOMContentLoaded", render); // âœ… ä¿è­‰è¼‰å…¥å®Œå°±æ¸²æŸ“
render(); // âœ… ä¿åº•
render();
</script>
</body>
</html>
